import React, { useState, useEffect, useCallback, useRef } from 'react';
import { KidsCard, KidsButton } from './ui/KidsUIComponents';
import { 
  SuccessAnimatedButton,
  AnimatedProgress,
  HoverScaleCard,
  FloatingActionButton,
  ParticleBackground,
  SmileyRating,
  AchievementToast,
  FireworksEffect
} from './ui/MicroInteractions';

/**
 * üéÆ Advanced Gamification Hub
 * „Ç®„É≥„Ç≤„Éº„Ç∏„É°„É≥„ÉàÊúÄÂ§ßÂåñ„ÅÆ„Åü„ÇÅ„ÅÆÂåÖÊã¨ÁöÑ„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥„Éª„Ç∑„Çπ„ÉÜ„É†
 * Ëá™Â∑±Ê±∫ÂÆöÁêÜË´ñ„Éª„Éï„É≠„ÉºÁêÜË´ñ„ÉªË°åÂãïÁµåÊ∏àÂ≠¶„ÇíÁµ±Âêà„Åó„ÅüÊ¨°‰∏ñ‰ª£Â≠¶Áøí‰ΩìÈ®ì
 */

interface AdvancedGamificationHubProps {
  userId: string;
  className?: string;
}

interface GamificationProfile {
  playerId: string;
  playerName: string;
  avatar: PlayerAvatar;
  level: number;
  totalXP: number;
  xpToNextLevel: number;
  playerType: PlayerType;
  motivationProfile: MotivationProfile;
  gamificationPreferences: GamificationPreferences;
  progressJourney: ProgressJourney;
  socialConnections: SocialConnection[];
  achievements: Achievement[];
  badges: Badge[];
  streaks: Streak[];
  challenges: Challenge[];
  rewards: Reward[];
  leaderboardPositions: LeaderboardPosition[];
}

interface PlayerAvatar {
  baseAvatar: string;
  customizations: AvatarCustomization[];
  unlockableItems: UnlockableItem[];
  currentOutfit: AvatarOutfit;
  emotionalState: EmotionalState;
}

interface AvatarCustomization {
  category: 'outfit' | 'accessory' | 'background' | 'pose' | 'expression';
  itemId: string;
  name: string;
  rarity: 'common' | 'rare' | 'epic' | 'legendary';
  unlockCondition: string;
  isUnlocked: boolean;
  isEquipped: boolean;
}

interface UnlockableItem {
  itemId: string;
  name: string;
  description: string;
  category: string;
  unlockCondition: UnlockCondition;
  visualPreview: string;
  rarity: string;
  value: number;
}

interface UnlockCondition {
  type: 'xp' | 'achievement' | 'streak' | 'challenge' | 'social' | 'time';
  requirement: any;
  progress: number;
  completed: boolean;
}

interface AvatarOutfit {
  outfit: string;
  accessories: string[];
  background: string;
  pose: string;
  expression: string;
}

interface EmotionalState {
  primary: 'happy' | 'excited' | 'focused' | 'proud' | 'curious' | 'determined';
  intensity: number;
  duration: number;
  triggers: string[];
}

interface PlayerType {
  primary: 'achiever' | 'explorer' | 'socializer' | 'competitor' | 'creator';
  secondary: string[];
  adaptability: number;
  preferences: PlayerPreferences;
}

interface PlayerPreferences {
  competitionLevel: number;
  collaborationLevel: number;
  explorationLevel: number;
  achievementOrientation: number;
  creativityExpression: number;
  socialInteraction: number;
}

interface MotivationProfile {
  intrinsicMotivation: IntrinsicMotivationFactors;
  extrinsicMotivation: ExtrinsicMotivationFactors;
  motivationalTrends: MotivationalTrend[];
  engagementDrivers: EngagementDriver[];
  demotivationTriggers: DemotivationTrigger[];
}

interface IntrinsicMotivationFactors {
  autonomy: number;
  mastery: number;
  purpose: number;
  curiosity: number;
  creativity: number;
  socialConnection: number;
}

interface ExtrinsicMotivationFactors {
  points: number;
  badges: number;
  leaderboards: number;
  rewards: number;
  recognition: number;
  competition: number;
}

interface MotivationalTrend {
  factor: string;
  trend: 'increasing' | 'stable' | 'decreasing';
  timeframe: string;
  change_rate: number;
}

interface EngagementDriver {
  driver: string;
  effectiveness: number;
  context: string[];
  sustainability: number;
}

interface DemotivationTrigger {
  trigger: string;
  impact: number;
  frequency: number;
  mitigation_strategies: string[];
}

interface GamificationPreferences {
  preferredMechanics: GameMechanic[];
  difficulty_preference: number;
  feedback_frequency: 'immediate' | 'periodic' | 'milestone';
  social_visibility: 'public' | 'friends' | 'private';
  challenge_types: string[];
  reward_preferences: string[];
}

interface GameMechanic {
  mechanic: string;
  preference: number;
  effectiveness: number;
  context_suitability: string[];
}

interface ProgressJourney {
  currentQuest: Quest | null;
  completedQuests: Quest[];
  journeyMilestones: JourneyMilestone[];
  pathProgress: PathProgress;
  storyProgression: StoryProgression;
  characterDevelopment: CharacterDevelopment;
}

interface Quest {
  questId: string;
  title: string;
  description: string;
  type: 'main' | 'side' | 'daily' | 'weekly' | 'special' | 'social';
  difficulty: number;
  estimatedTime: number;
  objectives: QuestObjective[];
  rewards: QuestReward[];
  prerequisites: string[];
  timeLimit?: Date;
  progress: number;
  status: 'available' | 'active' | 'completed' | 'failed' | 'locked';
  narrative: QuestNarrative;
}

interface QuestObjective {
  objectiveId: string;
  description: string;
  type: 'learn' | 'practice' | 'achieve' | 'explore' | 'create' | 'help';
  target: any;
  progress: number;
  completed: boolean;
  optional: boolean;
}

interface QuestReward {
  type: 'xp' | 'item' | 'badge' | 'access' | 'customization' | 'social';
  value: any;
  rarity: string;
  immediate: boolean;
}

interface QuestNarrative {
  introduction: string;
  progressUpdates: { [milestone: number]: string };
  completion: string;
  characterDialogue: CharacterDialogue[];
}

interface CharacterDialogue {
  character: string;
  dialogue: string;
  emotion: string;
  timing: 'start' | 'progress' | 'completion' | 'failure';
}

interface JourneyMilestone {
  milestoneId: string;
  title: string;
  description: string;
  achieved: boolean;
  achievedAt?: Date;
  requirements: string[];
  significance: 'minor' | 'major' | 'epic';
  celebration: CelebrationData;
}

interface CelebrationData {
  type: 'animation' | 'fireworks' | 'confetti' | 'sound' | 'story';
  intensity: number;
  duration: number;
  specialEffects: string[];
}

interface PathProgress {
  totalNodes: number;
  completedNodes: number;
  currentNode: ProgressNode;
  unlockedPaths: string[];
  discoveries: Discovery[];
}

interface ProgressNode {
  nodeId: string;
  type: 'lesson' | 'skill' | 'challenge' | 'boss' | 'treasure' | 'story';
  position: [number, number];
  unlocked: boolean;
  completed: boolean;
  difficulty: number;
  rewards: string[];
}

interface Discovery {
  discoveryId: string;
  name: string;
  description: string;
  type: 'knowledge' | 'skill' | 'secret' | 'easter_egg' | 'shortcut';
  discoveredAt: Date;
  value: number;
}

interface StoryProgression {
  currentChapter: number;
  totalChapters: number;
  chapterProgress: ChapterProgress[];
  characters: StoryCharacter[];
  plotPoints: PlotPoint[];
  playerChoices: PlayerChoice[];
}

interface ChapterProgress {
  chapterNumber: number;
  title: string;
  completed: boolean;
  scenesCompleted: number;
  totalScenes: number;
  keyEvents: string[];
}

interface StoryCharacter {
  characterId: string;
  name: string;
  role: 'mentor' | 'companion' | 'challenger' | 'guide' | 'ally';
  relationship: number;
  personality: string[];
  backstory: string;
  currentMood: string;
}

interface PlotPoint {
  plotId: string;
  description: string;
  importance: 'minor' | 'major' | 'climax';
  triggered: boolean;
  triggerConditions: string[];
  consequences: string[];
}

interface PlayerChoice {
  choiceId: string;
  situation: string;
  options: ChoiceOption[];
  selectedOption: string;
  consequences: string[];
  madeAt: Date;
}

interface ChoiceOption {
  optionId: string;
  description: string;
  alignment: 'explorer' | 'achiever' | 'helper' | 'competitor';
  consequences: string[];
}

interface CharacterDevelopment {
  abilities: CharacterAbility[];
  skills: CharacterSkill[];
  traits: CharacterTrait[];
  specialPowers: SpecialPower[];
  reputation: Reputation;
}

interface CharacterAbility {
  abilityId: string;
  name: string;
  level: number;
  maxLevel: number;
  experience: number;
  description: string;
  benefits: string[];
  upgradeRequirements: string[];
}

interface CharacterSkill {
  skillId: string;
  name: string;
  proficiency: number;
  category: string;
  practiceTime: number;
  applications: string[];
  mastery_indicators: string[];
}

interface CharacterTrait {
  traitId: string;
  name: string;
  strength: number;
  description: string;
  manifestations: string[];
  development_path: string[];
}

interface SpecialPower {
  powerId: string;
  name: string;
  description: string;
  unlocked: boolean;
  usageCount: number;
  maxUsages: number;
  cooldown: number;
  effects: string[];
}

interface Reputation {
  overall: number;
  categories: { [category: string]: number };
  titles: string[];
  recognitions: Recognition[];
}

interface Recognition {
  type: string;
  source: string;
  description: string;
  earnedAt: Date;
  visibility: string;
}

interface Achievement {
  achievementId: string;
  title: string;
  description: string;
  category: 'learning' | 'social' | 'creative' | 'persistence' | 'discovery' | 'mastery';
  rarity: 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary' | 'mythic';
  icon: string;
  points: number;
  unlockedAt: Date;
  shareStatus: 'private' | 'friends' | 'public';
  prerequisites: string[];
  series?: AchievementSeries;
}

interface AchievementSeries {
  seriesId: string;
  name: string;
  totalAchievements: number;
  completed: number;
  seriesReward: any;
}

interface Badge {
  badgeId: string;
  name: string;
  description: string;
  design: BadgeDesign;
  earnedAt: Date;
  level: number;
  maxLevel: number;
  category: string;
  displayPriority: number;
}

interface BadgeDesign {
  shape: string;
  colors: string[];
  symbols: string[];
  animation: string;
  rarity_effects: string[];
}

interface Streak {
  streakId: string;
  type: 'daily_login' | 'study_session' | 'problem_solving' | 'achievement' | 'social';
  currentStreak: number;
  longestStreak: number;
  lastActivity: Date;
  milestones: StreakMilestone[];
  rewardsTier: number;
  active: boolean;
}

interface StreakMilestone {
  milestone: number;
  reward: string;
  achieved: boolean;
  achievedAt?: Date;
}

interface Challenge {
  challengeId: string;
  title: string;
  description: string;
  type: 'personal' | 'competitive' | 'collaborative' | 'community';
  difficulty: number;
  duration: number;
  participants: string[];
  progress: ChallengeProgress;
  rewards: ChallengeReward[];
  startDate: Date;
  endDate: Date;
  status: 'upcoming' | 'active' | 'completed' | 'expired';
}

interface ChallengeProgress {
  current: number;
  target: number;
  milestones: ChallengeMilestone[];
  ranking?: number;
  teamProgress?: number;
}

interface ChallengeMilestone {
  milestone: number;
  description: string;
  reached: boolean;
  reward: string;
}

interface ChallengeReward {
  tier: number;
  description: string;
  value: any;
  type: string;
}

interface Reward {
  rewardId: string;
  name: string;
  description: string;
  type: 'virtual_item' | 'real_reward' | 'privilege' | 'access' | 'recognition';
  value: number;
  rarity: string;
  earnedAt: Date;
  redeemed: boolean;
  redeemedAt?: Date;
  expiresAt?: Date;
}

interface SocialConnection {
  connectionId: string;
  friendId: string;
  friendName: string;
  relationshipType: 'friend' | 'study_buddy' | 'competitor' | 'mentor' | 'mentee';
  connectionStrength: number;
  sharedActivities: SharedActivity[];
  collaborativeAchievements: string[];
  mutualChallenges: string[];
}

interface SharedActivity {
  activityId: string;
  type: 'study_session' | 'challenge' | 'achievement' | 'discovery';
  description: string;
  participants: string[];
  completedAt: Date;
  outcome: string;
}

interface LeaderboardPosition {
  leaderboardId: string;
  category: string;
  position: number;
  score: number;
  trend: 'rising' | 'stable' | 'falling';
  timeframe: 'daily' | 'weekly' | 'monthly' | 'all_time';
}

const AdvancedGamificationHub: React.FC<AdvancedGamificationHubProps> = ({ 
  userId, 
  className = '' 
}) => {
  const [selectedTab, setSelectedTab] = useState<'profile' | 'quests' | 'achievements' | 'social' | 'story'>('profile');
  const [gamificationProfile, setGamificationProfile] = useState<GamificationProfile | null>(null);
  const [activeQuest, setActiveQuest] = useState<Quest | null>(null);
  const [showLevelUp, setShowLevelUp] = useState<boolean>(false);
  const [showAchievement, setShowAchievement] = useState<Achievement | null>(null);
  const [showFireworks, setShowFireworks] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    initializeGamificationHub();
  }, [userId]);

  const initializeGamificationHub = async () => {
    setIsLoading(true);
    try {
      await Promise.all([
        loadGamificationProfile(),
        loadActiveQuests(),
        checkForNewAchievements(),
        loadSocialData()
      ]);
    } catch (error) {
      console.error('„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥„Éè„ÉñÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const loadGamificationProfile = async () => {
    // Mock data - ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØAPI„Åã„ÇâÂèñÂæó
    const profile: GamificationProfile = {
      playerId: userId,
      playerName: 'ÂãáËÄÖÂ§™ÈÉé',
      avatar: {
        baseAvatar: 'üßë‚Äçüéì',
        customizations: [
          {
            category: 'outfit',
            itemId: 'wizard_robe',
            name: 'Áü•ÊÅµ„ÅÆÊ≥ïË°£',
            rarity: 'epic',
            unlockCondition: '„É¨„Éô„É´20Âà∞ÈÅî',
            isUnlocked: true,
            isEquipped: true
          },
          {
            category: 'accessory',
            itemId: 'crown_of_knowledge',
            name: 'Áü•Ë≠ò„ÅÆÁéãÂÜ†',
            rarity: 'legendary',
            unlockCondition: '100ÂõûÈÄ£Á∂öÊ≠£Á≠î',
            isUnlocked: false,
            isEquipped: false
          }
        ],
        unlockableItems: [],
        currentOutfit: {
          outfit: 'wizard_robe',
          accessories: ['magic_wand'],
          background: 'library',
          pose: 'thinking',
          expression: 'determined'
        },
        emotionalState: {
          primary: 'excited',
          intensity: 0.8,
          duration: 300,
          triggers: ['achievement_unlocked', 'level_up']
        }
      },
      level: 23,
      totalXP: 12450,
      xpToNextLevel: 550,
      playerType: {
        primary: 'achiever',
        secondary: ['explorer', 'socializer'],
        adaptability: 0.8,
        preferences: {
          competitionLevel: 0.7,
          collaborationLevel: 0.8,
          explorationLevel: 0.9,
          achievementOrientation: 0.95,
          creativityExpression: 0.6,
          socialInteraction: 0.75
        }
      },
      motivationProfile: {
        intrinsicMotivation: {
          autonomy: 0.85,
          mastery: 0.92,
          purpose: 0.78,
          curiosity: 0.88,
          creativity: 0.65,
          socialConnection: 0.75
        },
        extrinsicMotivation: {
          points: 0.7,
          badges: 0.8,
          leaderboards: 0.6,
          rewards: 0.75,
          recognition: 0.85,
          competition: 0.7
        },
        motivationalTrends: [
          {
            factor: 'mastery',
            trend: 'increasing',
            timeframe: 'ÈÅéÂéª4ÈÄ±Èñì',
            change_rate: 0.15
          }
        ],
        engagementDrivers: [
          {
            driver: 'progressive_challenges',
            effectiveness: 0.9,
            context: ['Êñ∞Ê¶ÇÂøµÂ≠¶Áøí', '„Çπ„Ç≠„É´Á∑¥Áøí'],
            sustainability: 0.85
          }
        ],
        demotivationTriggers: [
          {
            trigger: 'repetitive_tasks',
            impact: 0.6,
            frequency: 0.3,
            mitigation_strategies: ['variety_injection', 'context_switching']
          }
        ]
      },
      gamificationPreferences: {
        preferredMechanics: [
          {
            mechanic: 'progressive_challenges',
            preference: 0.9,
            effectiveness: 0.85,
            context_suitability: ['skill_building', 'mastery']
          },
          {
            mechanic: 'achievement_unlock',
            preference: 0.85,
            effectiveness: 0.8,
            context_suitability: ['milestone_completion', 'recognition']
          }
        ],
        difficulty_preference: 0.75,
        feedback_frequency: 'immediate',
        social_visibility: 'friends',
        challenge_types: ['mastery', 'exploration', 'creativity'],
        reward_preferences: ['customization', 'access', 'recognition']
      },
      progressJourney: {
        currentQuest: {
          questId: 'main_quest_5',
          title: 'ÂàÜÊï∞„ÅÆÁßòÂØÜ„ÇíËß£„ÅçÊòé„Åã„ÅõÔºÅ',
          description: 'Âè§‰ª£„ÅÆÊï∞Â≠¶ÈÅ∫Ë∑°„ÅßÁô∫Ë¶ã„Åï„Çå„ÅüÂàÜÊï∞„ÅÆË¨é„ÇíËß£„Åç„ÄÅÊñ∞„Åü„Å™Ë®àÁÆó„Çπ„Ç≠„É´„ÇíÁøíÂæó„Åó„Çà„ÅÜ',
          type: 'main',
          difficulty: 6,
          estimatedTime: 120,
          objectives: [
            {
              objectiveId: 'obj1',
              description: 'ÂàÜÊï∞„ÅÆÂü∫Êú¨Ê¶ÇÂøµ„ÇíÁêÜËß£„Åô„Çã',
              type: 'learn',
              target: { concept: 'fractions_basics' },
              progress: 100,
              completed: true,
              optional: false
            },
            {
              objectiveId: 'obj2',
              description: 'ÂàÜÊï∞„ÅÆË®àÁÆó„Çí10ÂïèÈÄ£Á∂öÊ≠£Á≠î',
              type: 'practice',
              target: { correct_answers: 10, consecutive: true },
              progress: 70,
              completed: false,
              optional: false
            },
            {
              objectiveId: 'obj3',
              description: 'ÂàÜÊï∞„Çí‰Ωø„Å£„ÅüÂÆüÁîüÊ¥ªÂïèÈ°å„ÇíËß£„Åè',
              type: 'achieve',
              target: { real_world_problems: 3 },
              progress: 33,
              completed: false,
              optional: false
            }
          ],
          rewards: [
            { type: 'xp', value: 500, rarity: 'common', immediate: false },
            { type: 'badge', value: 'fraction_master', rarity: 'rare', immediate: false },
            { type: 'customization', value: 'calculator_wand', rarity: 'epic', immediate: false }
          ],
          prerequisites: ['basic_arithmetic'],
          progress: 67,
          status: 'active',
          narrative: {
            introduction: 'Êï∞Â≠¶ËÄÖ„ÅÆÈÅ∫Ë∑°„ÅßÂè§‰ª£„ÅÆÂàÜÊï∞„Éë„Ç∫„É´„ÇíÁô∫Ë¶ãÔºÅ',
            progressUpdates: {
              25: 'ÊúÄÂàù„ÅÆÊâã„Åå„Åã„Çä„ÇíË¶ã„Å§„Åë„Åü...',
              50: 'ÂàÜÊï∞„ÅÆÁúü„ÅÆÂäõ„ÅåË¶ã„Åà„Å¶„Åç„ÅüÔºÅ',
              75: '„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÁßòÂØÜ„ÅåËß£Êòé„Åï„Çå„Çã...'
            },
            completion: 'Ë¶ã‰∫ãÔºÅÂàÜÊï∞„ÅÆÁßòÂØÜ„ÇíËß£„ÅçÊòé„Åã„Åó„ÄÅÊñ∞„Åü„Å™Âäõ„ÇíÊâã„Å´ÂÖ•„Çå„ÅüÔºÅ',
            characterDialogue: [
              {
                character: 'wise_owl',
                dialogue: 'Á¥†Êô¥„Çâ„Åó„ÅÑÈÄ≤Ê≠©„Å†„Å≠ÔºÅÂàÜÊï∞„ÅÆÊú¨Ë≥™„ÇíÁêÜËß£„ÅóÂßã„ÇÅ„Å¶„ÅÑ„Çã',
                emotion: 'proud',
                timing: 'progress'
              }
            ]
          }
        },
        completedQuests: [],
        journeyMilestones: [
          {
            milestoneId: 'level_20',
            title: 'Â≠¶Áøí„ÅÆÈÅî‰∫∫',
            description: '„É¨„Éô„É´20„Å´Âà∞ÈÅî„Åó„ÄÅÁúü„ÅÆÂ≠¶ÁøíËÄÖ„Å®„Åó„Å¶Ë™ç„ÇÅ„Çâ„Çå„Åü',
            achieved: true,
            achievedAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
            requirements: ['reach_level_20'],
            significance: 'major',
            celebration: {
              type: 'fireworks',
              intensity: 0.8,
              duration: 5000,
              specialEffects: ['golden_sparkles', 'achievement_fanfare']
            }
          }
        ],
        pathProgress: {
          totalNodes: 150,
          completedNodes: 89,
          currentNode: {
            nodeId: 'fraction_calculations',
            type: 'skill',
            position: [12, 8],
            unlocked: true,
            completed: false,
            difficulty: 6,
            rewards: ['xp_boost', 'skill_point']
          },
          unlockedPaths: ['arithmetic_mastery', 'problem_solving', 'real_world_math'],
          discoveries: [
            {
              discoveryId: 'shortcut_1',
              name: 'Ë®àÁÆó„ÅÆËøëÈÅì',
              description: 'ÂàÜÊï∞Ë®àÁÆó„ÅÆÂäπÁéáÁöÑ„Å™ÊñπÊ≥ï„ÇíÁô∫Ë¶ã',
              type: 'shortcut',
              discoveredAt: new Date(),
              value: 100
            }
          ]
        },
        storyProgression: {
          currentChapter: 3,
          totalChapters: 10,
          chapterProgress: [
            {
              chapterNumber: 1,
              title: 'Êï∞„ÅÆÂÜíÈô∫„ÅÆÂßã„Åæ„Çä',
              completed: true,
              scenesCompleted: 5,
              totalScenes: 5,
              keyEvents: ['first_calculation', 'mentor_meeting']
            },
            {
              chapterNumber: 2,
              title: 'ÂõõÂâáÊºîÁÆó„ÅÆË©¶Á∑¥',
              completed: true,
              scenesCompleted: 8,
              totalScenes: 8,
              keyEvents: ['addition_mastery', 'multiplication_challenge']
            },
            {
              chapterNumber: 3,
              title: 'ÂàÜÊï∞„ÅÆË¨é',
              completed: false,
              scenesCompleted: 4,
              totalScenes: 7,
              keyEvents: ['fraction_introduction', 'ancient_puzzle']
            }
          ],
          characters: [
            {
              characterId: 'wise_owl',
              name: '„Éï„ÇØ„É≠„Ç¶ÂÖàÁîü',
              role: 'mentor',
              relationship: 0.85,
              personality: ['wise', 'patient', 'encouraging'],
              backstory: 'Âè§‰ª£„Åã„ÇâÊï∞Â≠¶„ÅÆÁßòÂØÜ„ÇíÂÆà„ÇäÁ∂ö„Åë„ÇãË≥¢ËÄÖ',
              currentMood: 'proud'
            },
            {
              characterId: 'calc_cat',
              name: '„Ç´„É´„ÇØ„É´',
              role: 'companion',
              relationship: 0.92,
              personality: ['playful', 'clever', 'supportive'],
              backstory: 'Ë®àÁÆó„ÅåÂ§ßÂ•Ω„Åç„Å™È≠îÊ≥ï„ÅÆÁå´',
              currentMood: 'excited'
            }
          ],
          plotPoints: [
            {
              plotId: 'ancient_secret',
              description: 'Âè§‰ª£Êï∞Â≠¶ËÄÖ„ÅÆÈö†„Åï„Çå„ÅüÁßòÂØÜ',
              importance: 'major',
              triggered: false,
              triggerConditions: ['complete_chapter_5'],
              consequences: ['unlock_advanced_skills', 'new_character_introduction']
            }
          ],
          playerChoices: []
        },
        characterDevelopment: {
          abilities: [
            {
              abilityId: 'quick_calculation',
              name: 'È´òÈÄüË®àÁÆó',
              level: 8,
              maxLevel: 10,
              experience: 450,
              description: 'Ë®àÁÆóÈÄüÂ∫¶„ÅåÂêë‰∏ä„Åó„ÄÅ„Çà„ÇäÁ¥†Êó©„ÅèÂïèÈ°å„ÇíËß£„Åë„Çã',
              benefits: ['calculation_speed_boost', 'time_efficiency'],
              upgradeRequirements: ['practice_500_problems']
            }
          ],
          skills: [
            {
              skillId: 'arithmetic',
              name: 'ÁÆóË°ì',
              proficiency: 0.85,
              category: 'mathematics',
              practiceTime: 2400,
              applications: ['basic_calculations', 'word_problems'],
              mastery_indicators: ['speed', 'accuracy', 'versatility']
            }
          ],
          traits: [
            {
              traitId: 'persistence',
              name: 'Á≤ò„ÇäÂº∑„Åï',
              strength: 0.9,
              description: 'Âõ∞Èõ£„Å™ÂïèÈ°å„Å´„ÇÇË´¶„ÇÅ„Åö„Å´Âèñ„ÇäÁµÑ„ÇÄ',
              manifestations: ['retry_difficult_problems', 'extended_study_sessions'],
              development_path: ['challenge_completion', 'failure_recovery']
            }
          ],
          specialPowers: [
            {
              powerId: 'insight_flash',
              name: '„Å≤„Çâ„ÇÅ„Åç„Éï„É©„ÉÉ„Ç∑„É•',
              description: 'Èõ£„Åó„ÅÑÂïèÈ°å„ÅÆ„Éí„É≥„Éà„ÅåË¶ã„Åà„ÇãÁâπÊÆäËÉΩÂäõ',
              unlocked: true,
              usageCount: 2,
              maxUsages: 3,
              cooldown: 0,
              effects: ['hint_revelation', 'confidence_boost']
            }
          ],
          reputation: {
            overall: 0.82,
            categories: { 'mathematics': 0.9, 'persistence': 0.85, 'collaboration': 0.7 },
            titles: ['Ë®àÁÆó„ÅÆÈÅî‰∫∫', 'Á≤ò„ÇäÂº∑„ÅçÂ≠¶ÁøíËÄÖ'],
            recognitions: []
          }
        }
      },
      socialConnections: [],
      achievements: [
        {
          achievementId: 'first_perfect_score',
          title: 'ÂÆåÁíß„Å™Âßã„Åæ„Çä',
          description: 'Âàù„ÇÅ„Å¶„ÅÆ„ÉÜ„Çπ„Éà„ÅßÊ∫ÄÁÇπ„ÇíÁç≤Âæó',
          category: 'learning',
          rarity: 'rare',
          icon: 'üåü',
          points: 100,
          unlockedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000),
          shareStatus: 'friends',
          prerequisites: []
        },
        {
          achievementId: 'week_streak',
          title: '‰∏ÄÈÄ±Èñì„ÅÆÁ∂ôÁ∂ö',
          description: '7Êó•ÈñìÈÄ£Á∂ö„ÅßÂ≠¶Áøí„ÇíÁ∂ôÁ∂ö',
          category: 'persistence',
          rarity: 'uncommon',
          icon: 'üî•',
          points: 150,
          unlockedAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
          shareStatus: 'public',
          prerequisites: []
        }
      ],
      badges: [
        {
          badgeId: 'arithmetic_master',
          name: 'ÁÆóË°ì„Éû„Çπ„Çø„Éº',
          description: 'Âü∫Êú¨ÁöÑ„Å™ÁÆóË°ìË®àÁÆó„ÇíÁøíÂæó',
          design: {
            shape: 'shield',
            colors: ['gold', 'blue'],
            symbols: ['plus', 'minus', 'multiply', 'divide'],
            animation: 'glow',
            rarity_effects: ['golden_border']
          },
          earnedAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000),
          level: 3,
          maxLevel: 5,
          category: 'skill',
          displayPriority: 1
        }
      ],
      streaks: [
        {
          streakId: 'daily_study',
          type: 'study_session',
          currentStreak: 12,
          longestStreak: 28,
          lastActivity: new Date(),
          milestones: [
            { milestone: 7, reward: '„Çπ„Éà„É™„Éº„ÇØ„Éê„ÉÉ„Ç∏', achieved: true, achievedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000) },
            { milestone: 14, reward: 'ÁâπÂà•„Ç¢„Éê„Çø„Éº', achieved: false },
            { milestone: 30, reward: '„É¨„Ç∏„Çß„É≥„ÉÄ„É™„Éº„Éê„ÉÉ„Ç∏', achieved: false }
          ],
          rewardsTier: 2,
          active: true
        }
      ],
      challenges: [
        {
          challengeId: 'weekly_math',
          title: '‰ªäÈÄ±„ÅÆÊï∞Â≠¶„ÉÅ„É£„É¨„É≥„Ç∏',
          description: '‰ªäÈÄ±‰∏≠„Å´100Âïè„ÅÆÁÆóÊï∞ÂïèÈ°å„ÇíËß£„Åì„ÅÜ',
          type: 'personal',
          difficulty: 5,
          duration: 7,
          participants: [userId],
          progress: {
            current: 67,
            target: 100,
            milestones: [
              { milestone: 25, description: 'ÂõõÂàÜ„ÅÆ‰∏ÄÈÅîÊàê', reached: true, reward: 'XP+50' },
              { milestone: 50, description: 'ÂçäÂàÜÈÅîÊàê', reached: true, reward: 'XP+100' },
              { milestone: 75, description: 'ÂõõÂàÜ„ÅÆ‰∏âÈÅîÊàê', reached: false, reward: 'XP+150' },
              { milestone: 100, description: 'ÂÆåÂÖ®ÈÅîÊàê', reached: false, reward: 'ÁâπÂà•„Éê„ÉÉ„Ç∏' }
            ]
          },
          rewards: [
            { tier: 1, description: '„Éñ„É≠„É≥„Ç∫„Éê„ÉÉ„Ç∏', value: 'bronze_badge', type: 'badge' },
            { tier: 2, description: '„Ç∑„É´„Éê„Éº„Éê„ÉÉ„Ç∏', value: 'silver_badge', type: 'badge' },
            { tier: 3, description: '„Ç¥„Éº„É´„Éâ„Éê„ÉÉ„Ç∏', value: 'gold_badge', type: 'badge' }
          ],
          startDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
          endDate: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000),
          status: 'active'
        }
      ],
      rewards: [],
      leaderboardPositions: [
        {
          leaderboardId: 'weekly_xp',
          category: '‰ªäÈÄ±„ÅÆXP',
          position: 3,
          score: 1250,
          trend: 'rising',
          timeframe: 'weekly'
        }
      ]
    };

    setGamificationProfile(profile);
    if (profile.progressJourney.currentQuest) {
      setActiveQuest(profile.progressJourney.currentQuest);
    }
  };

  const loadActiveQuests = async () => {
    // „ÇØ„Ç®„Çπ„Éà„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
  };

  const checkForNewAchievements = async () => {
    // Êñ∞„Åó„ÅÑ„Ç¢„ÉÅ„Éº„Éñ„É°„É≥„Éà„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
  };

  const loadSocialData = async () => {
    // „ÇΩ„Éº„Ç∑„É£„É´„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
  };

  if (isLoading) {
    return (
      <div className={`flex items-center justify-center min-h-screen ${className}`}>
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"></div>
          <p className="text-gray-600">„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥„Éè„ÉñË™≠„ÅøËæº„Åø‰∏≠...</p>
        </div>
      </div>
    );
  }

  if (!gamificationProfile) {
    return <div>„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü</div>;
  }

  return (
    <div className={`min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 ${className}`}>
      <ParticleBackground particleCount={30} color="#8B5CF6" speed={0.3} />
      
      {/* „É¨„Éô„É´„Ç¢„ÉÉ„Éó„Ç®„Éï„Çß„ÇØ„Éà */}
      <FireworksEffect trigger={showFireworks} />
      
      {/* „Ç¢„ÉÅ„Éº„Éñ„É°„É≥„ÉàÈÄöÁü• */}
      {showAchievement && (
        <AchievementToast
          achievement={{
            title: showAchievement.title,
            description: showAchievement.description,
            icon: showAchievement.icon,
            rarity: showAchievement.rarity as any
          }}
          onClose={() => setShowAchievement(null)}
        />
      )}

      <div className="container mx-auto px-4 py-6">
        <div className="max-w-7xl mx-auto">
          {/* „Éò„ÉÉ„ÉÄ„Éº */}
          <div className="text-center mb-8">
            <h1 className="text-4xl font-bold text-gray-800 mb-4">
              üéÆ Â≠¶Áøí„Ç¢„Éâ„Éô„É≥„ÉÅ„É£„Éº
            </h1>
            <p className="text-lg text-gray-600">
              {gamificationProfile.playerName}„ÅÆÂÜíÈô∫„ÅÆË®òÈå≤
            </p>
          </div>

          {/* „Éó„É¨„Ç§„É§„Éº„Çπ„ÉÜ„Éº„Çø„Çπ */}
          <div className="mb-8">
            <KidsCard title="‚≠ê „ÅÇ„Å™„Åü„ÅÆÂÜíÈô∫ËÄÖÊÉÖÂ†±" icon="üßë‚Äçüéì" color="purple">
              <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                {/* „Ç¢„Éê„Çø„Éº */}
                <div className="text-center">
                  <div className="text-8xl mb-3">{gamificationProfile.avatar.baseAvatar}</div>
                  <h3 className="text-lg font-semibold text-gray-800 mb-2">
                    {gamificationProfile.playerName}
                  </h3>
                  <div className="text-sm text-gray-600">
                    „É¨„Éô„É´ {gamificationProfile.level} {gamificationProfile.playerType.primary === 'achiever' ? 'ÈÅîÊàêËÄÖ' : 'Êé¢Ê§úÂÆ∂'}
                  </div>
                </div>

                {/* „É¨„Éô„É´„ÉªXP */}
                <div>
                  <h4 className="font-medium text-gray-800 mb-3">üìä ÊàêÈï∑Ë®òÈå≤</h4>
                  <div className="space-y-3">
                    <div>
                      <div className="flex justify-between text-sm mb-1">
                        <span>„É¨„Éô„É´ {gamificationProfile.level}</span>
                        <span>{gamificationProfile.totalXP} XP</span>
                      </div>
                      <AnimatedProgress 
                        progress={(gamificationProfile.totalXP % 1000) / 10}
                        color="purple"
                        label={`Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß ${gamificationProfile.xpToNextLevel} XP`}
                      />
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-purple-600">
                        {gamificationProfile.totalXP.toLocaleString()}
                      </div>
                      <div className="text-xs text-gray-600">Á∑èÁç≤ÂæóÁµåÈ®ìÂÄ§</div>
                    </div>
                  </div>
                </div>

                {/* „Çπ„Éà„É™„Éº„ÇØ */}
                <div>
                  <h4 className="font-medium text-gray-800 mb-3">üî• Á∂ôÁ∂öË®òÈå≤</h4>
                  <div className="space-y-2">
                    {gamificationProfile.streaks.slice(0, 2).map((streak) => (
                      <div key={streak.streakId} className="bg-orange-50 rounded-lg p-3">
                        <div className="flex justify-between items-center mb-1">
                          <span className="text-sm font-medium text-orange-800">
                            {streak.type === 'study_session' ? 'Â≠¶ÁøíÁ∂ôÁ∂ö' : '„É≠„Ç∞„Ç§„É≥Á∂ôÁ∂ö'}
                          </span>
                          <span className="text-lg font-bold text-orange-600">
                            {streak.currentStreak}Êó•
                          </span>
                        </div>
                        <div className="text-xs text-orange-600">
                          ÊúÄÈï∑Ë®òÈå≤: {streak.longestStreak}Êó•
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* ÊúÄÊñ∞„ÅÆÊàêÊûú */}
                <div>
                  <h4 className="font-medium text-gray-800 mb-3">üèÜ ÊúÄÊñ∞„ÅÆÊàêÊûú</h4>
                  <div className="space-y-2">
                    {gamificationProfile.achievements.slice(0, 2).map((achievement) => (
                      <div key={achievement.achievementId} className="bg-yellow-50 rounded-lg p-3">
                        <div className="flex items-center space-x-2 mb-1">
                          <span className="text-lg">{achievement.icon}</span>
                          <span className="text-sm font-medium text-yellow-800">
                            {achievement.title}
                          </span>
                        </div>
                        <div className="text-xs text-yellow-600">
                          {achievement.points} „Éù„Ç§„É≥„ÉàÁç≤Âæó
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </KidsCard>
          </div>

          {/* „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */}
          <div className="flex justify-center mb-8">
            <div className="bg-white rounded-xl p-2 shadow-lg border-2 border-gray-200">
              <div className="flex space-x-2">
                {[
                  { key: 'profile', label: 'üë§ „Éó„É≠„Éï„Ç£„Éº„É´', icon: 'üë§' },
                  { key: 'quests', label: '‚öîÔ∏è „ÇØ„Ç®„Çπ„Éà', icon: '‚öîÔ∏è' },
                  { key: 'achievements', label: 'üèÜ ÂÆüÁ∏æ', icon: 'üèÜ' },
                  { key: 'social', label: 'üë• „ÇΩ„Éº„Ç∑„É£„É´', icon: 'üë•' },
                  { key: 'story', label: 'üìñ „Çπ„Éà„Éº„É™„Éº', icon: 'üìñ' }
                ].map((tab) => (
                  <button
                    key={tab.key}
                    onClick={() => setSelectedTab(tab.key as any)}
                    className={`px-6 py-3 rounded-lg font-medium transition-all ${
                      selectedTab === tab.key
                        ? 'bg-purple-500 text-white shadow-md'
                        : 'text-gray-600 hover:bg-gray-100'
                    }`}
                  >
                    {tab.label}
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
          {selectedTab === 'profile' && (
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* „Ç¢„Éê„Çø„Éº„Ç´„Çπ„Çø„Éû„Ç§„Çº„Éº„Ç∑„Éß„É≥ */}
              <KidsCard title="üé® „Ç¢„Éê„Çø„Éº„Ç´„Çπ„Çø„Éû„Ç§„Ç∫" icon="‚ú®" color="purple">
                <div className="text-center mb-6">
                  <div className="text-8xl mb-4">{gamificationProfile.avatar.baseAvatar}</div>
                  <h3 className="text-lg font-semibold text-gray-800 mb-2">
                    ÁèæÂú®„ÅÆË£ÖÂÇô
                  </h3>
                  <div className="space-y-2">
                    {gamificationProfile.avatar.customizations
                      .filter(c => c.isEquipped)
                      .map((item) => (
                        <div key={item.itemId} className="inline-block bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm mr-2">
                          {item.name}
                        </div>
                      ))}
                  </div>
                </div>

                <div>
                  <h4 className="font-medium text-gray-800 mb-3">üîì Áç≤ÂæóÊ∏à„Åø„Ç¢„Ç§„ÉÜ„É†</h4>
                  <div className="grid grid-cols-2 gap-3">
                    {gamificationProfile.avatar.customizations
                      .filter(c => c.isUnlocked)
                      .map((item) => (
                        <HoverScaleCard
                          key={item.itemId}
                          className={`p-3 rounded-lg border cursor-pointer ${
                            item.isEquipped
                              ? 'bg-purple-100 border-purple-300'
                              : 'bg-gray-50 border-gray-200 hover:bg-purple-50'
                          }`}
                        >
                          <div className="text-center">
                            <div className="text-2xl mb-2">
                              {item.category === 'outfit' ? 'üëï' :
                               item.category === 'accessory' ? 'üëë' : 'üé®'}
                            </div>
                            <div className="text-sm font-medium text-gray-800">
                              {item.name}
                            </div>
                            <div className={`text-xs px-2 py-1 rounded mt-1 ${
                              item.rarity === 'legendary' ? 'bg-yellow-100 text-yellow-800' :
                              item.rarity === 'epic' ? 'bg-purple-100 text-purple-800' :
                              item.rarity === 'rare' ? 'bg-blue-100 text-blue-800' :
                              'bg-gray-100 text-gray-800'
                            }`}>
                              {item.rarity === 'legendary' ? '‚≠ê „É¨„Ç∏„Çß„É≥„ÉÄ„É™„Éº' :
                               item.rarity === 'epic' ? 'üíú „Ç®„Éî„ÉÉ„ÇØ' :
                               item.rarity === 'rare' ? 'üíé „É¨„Ç¢' : 'ü•â „Ç≥„É¢„É≥'}
                            </div>
                          </div>
                        </HoverScaleCard>
                      ))}
                  </div>
                </div>
              </KidsCard>

              {/* „Éó„É¨„Ç§„É§„Éº„Çø„Ç§„ÉóÂàÜÊûê */}
              <KidsCard title="üîç „ÅÇ„Å™„Åü„ÅÆÂ≠¶Áøí„Çπ„Çø„Ç§„É´" icon="üß†" color="blue">
                <div className="space-y-4">
                  <div className="text-center">
                    <div className="text-4xl mb-2">
                      {gamificationProfile.playerType.primary === 'achiever' ? 'üéØ' :
                       gamificationProfile.playerType.primary === 'explorer' ? 'üîç' :
                       gamificationProfile.playerType.primary === 'socializer' ? 'üë•' :
                       gamificationProfile.playerType.primary === 'competitor' ? '‚öîÔ∏è' : 'üé®'}
                    </div>
                    <h3 className="text-lg font-semibold text-gray-800 mb-2">
                      {gamificationProfile.playerType.primary === 'achiever' ? 'ÈÅîÊàêËÄÖ„Çø„Ç§„Éó' :
                       gamificationProfile.playerType.primary === 'explorer' ? 'Êé¢Ê§úÂÆ∂„Çø„Ç§„Éó' :
                       gamificationProfile.playerType.primary === 'socializer' ? '„ÇΩ„Éº„Ç∑„É£„É©„Ç§„Ç∂„Éº' :
                       gamificationProfile.playerType.primary === 'competitor' ? 'Á´∂‰∫âËÄÖ„Çø„Ç§„Éó' : '„ÇØ„É™„Ç®„Ç§„Çø„Éº„Çø„Ç§„Éó'}
                    </h3>
                    <p className="text-sm text-gray-600">
                      {gamificationProfile.playerType.primary === 'achiever' ? 
                        'ÁõÆÊ®ôÈÅîÊàê„Å®ÊàêÊûú„ÇíÈáçË¶ñ„Åó„ÄÅÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åô„Çã„Åì„Å®„ÇíÂ•Ω„Åø„Åæ„Åô' :
                       'Êñ∞„Åó„ÅÑÁô∫Ë¶ã„Å®Êé¢Á¥¢„ÇíÊ•Ω„Åó„Åø„ÄÅÂ≠¶Áøí„ÅÆÂπÖ„ÇíÂ∫É„Åí„Çã„Åì„Å®„ÇíÈáçË¶ñ„Åó„Åæ„Åô'}
                    </p>
                  </div>

                  <div>
                    <h4 className="font-medium text-gray-800 mb-3">üìä Â≠¶ÁøíÂÇæÂêë</h4>
                    <div className="space-y-3">
                      {Object.entries(gamificationProfile.playerType.preferences).map(([key, value]) => (
                        <div key={key}>
                          <div className="flex justify-between text-sm mb-1">
                            <span>
                              {key === 'competitionLevel' ? 'Á´∂‰∫âÊÄß' :
                               key === 'collaborationLevel' ? 'ÂçîË™øÊÄß' :
                               key === 'explorationLevel' ? 'Êé¢Ê±ÇÊÄß' :
                               key === 'achievementOrientation' ? 'ÈÅîÊàêÂøóÂêë' :
                               key === 'creativityExpression' ? 'ÂâµÈÄ†ÊÄß' :
                               key === 'socialInteraction' ? 'Á§æ‰∫§ÊÄß' : key}
                            </span>
                            <span>{Math.round(value * 100)}%</span>
                          </div>
                          <AnimatedProgress 
                            progress={value * 100}
                            color="blue"
                          />
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="bg-blue-50 rounded-lg p-3">
                    <h4 className="font-medium text-blue-800 mb-2">üí° „Åä„Åô„Åô„ÇÅ„ÅÆÂ≠¶ÁøíÊñπÊ≥ï</h4>
                    <div className="text-sm text-blue-700 space-y-1">
                      {gamificationProfile.playerType.primary === 'achiever' ? (
                        <>
                          <div>‚Ä¢ ÊòéÁ¢∫„Å™ÁõÆÊ®ôË®≠ÂÆö„Å®ÈÄ≤ÊçóËøΩË∑°</div>
                          <div>‚Ä¢ ÊÆµÈöéÁöÑ„Å™ÈÅîÊàê„Å®Â†±ÈÖ¨„Ç∑„Çπ„ÉÜ„É†</div>
                          <div>‚Ä¢ ÂÄã‰∫∫„ÅÆÊàêÈï∑Ë®òÈå≤„ÅÆÂèØË¶ñÂåñ</div>
                        </>
                      ) : (
                        <>
                          <div>‚Ä¢ Êñ∞„Åó„ÅÑÊ¶ÇÂøµ„ÅÆÁô∫Ë¶ã„Å®Êé¢Á¥¢</div>
                          <div>‚Ä¢ Â§öÊßò„Å™Â≠¶ÁøíÊñπÊ≥ï„ÅÆ‰ΩìÈ®ì</div>
                          <div>‚Ä¢ Èñ¢ÈÄ£Áü•Ë≠ò„ÅÆÂπÖÂ∫É„ÅÑÂ≠¶Áøí</div>
                        </>
                      )}
                    </div>
                  </div>
                </div>
              </KidsCard>
            </div>
          )}

          {/* „ÇØ„Ç®„Çπ„Éà„Çø„Éñ */}
          {selectedTab === 'quests' && activeQuest && (
            <div className="space-y-6">
              {/* „É°„Ç§„É≥„ÇØ„Ç®„Çπ„Éà */}
              <KidsCard title="‚öîÔ∏è ÁèæÂú®„ÅÆ„É°„Ç§„É≥„ÇØ„Ç®„Çπ„Éà" icon="üéØ" color="green">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  {/* „ÇØ„Ç®„Çπ„ÉàÊÉÖÂ†± */}
                  <div className="lg:col-span-2">
                    <div className="mb-4">
                      <h3 className="text-xl font-bold text-gray-800 mb-2">
                        {activeQuest.title}
                      </h3>
                      <p className="text-gray-600 mb-4">{activeQuest.description}</p>
                      
                      <div className="mb-4">
                        <div className="flex justify-between text-sm mb-1">
                          <span>„ÇØ„Ç®„Çπ„ÉàÈÄ≤Êçó</span>
                          <span>{activeQuest.progress}%</span>
                        </div>
                        <AnimatedProgress 
                          progress={activeQuest.progress}
                          color="green"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div>
                          <span className="text-gray-600">Èõ£ÊòìÂ∫¶: </span>
                          <span className="font-medium">‚òÖ{'‚òÖ'.repeat(activeQuest.difficulty - 1)}</span>
                        </div>
                        <div>
                          <span className="text-gray-600">‰∫àÊÉ≥ÊôÇÈñì: </span>
                          <span className="font-medium">{activeQuest.estimatedTime}ÂàÜ</span>
                        </div>
                      </div>
                    </div>

                    {/* ÁõÆÊ®ô‰∏ÄË¶ß */}
                    <div>
                      <h4 className="font-medium text-gray-800 mb-3">üéØ „ÇØ„Ç®„Çπ„ÉàÁõÆÊ®ô</h4>
                      <div className="space-y-3">
                        {activeQuest.objectives.map((objective) => (
                          <div key={objective.objectiveId} className="border border-gray-200 rounded-lg p-3">
                            <div className="flex items-center justify-between mb-2">
                              <span className={`text-sm font-medium ${
                                objective.completed ? 'text-green-800' : 'text-gray-800'
                              }`}>
                                {objective.completed ? '‚úÖ' : 'üî≤'} {objective.description}
                              </span>
                              <span className="text-xs text-gray-500">
                                {objective.progress}%
                              </span>
                            </div>
                            {!objective.completed && (
                              <div className="w-full bg-gray-200 rounded-full h-2">
                                <div
                                  className="bg-green-500 h-2 rounded-full"
                                  style={{ width: `${objective.progress}%` }}
                                />
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Â†±ÈÖ¨„Éª„Çπ„Éà„Éº„É™„Éº */}
                  <div className="space-y-4">
                    {/* Â†±ÈÖ¨ */}
                    <div>
                      <h4 className="font-medium text-gray-800 mb-3">üéÅ „ÇØ„Ç®„Çπ„ÉàÂ†±ÈÖ¨</h4>
                      <div className="space-y-2">
                        {activeQuest.rewards.map((reward, index) => (
                          <div key={index} className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                            <div className="text-sm font-medium text-yellow-800">
                              {reward.type === 'xp' ? `${reward.value} ÁµåÈ®ìÂÄ§` :
                               reward.type === 'badge' ? `${reward.value} „Éê„ÉÉ„Ç∏` :
                               reward.type === 'customization' ? `${reward.value} „Ç¢„Ç§„ÉÜ„É†` :
                               reward.value}
                            </div>
                            <div className={`text-xs ${
                              reward.rarity === 'epic' ? 'text-purple-600' :
                              reward.rarity === 'rare' ? 'text-blue-600' :
                              'text-gray-600'
                            }`}>
                              {reward.rarity === 'epic' ? 'üíú „Ç®„Éî„ÉÉ„ÇØ' :
                               reward.rarity === 'rare' ? 'üíé „É¨„Ç¢' : 'ü•â „Ç≥„É¢„É≥'}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* „Çπ„Éà„Éº„É™„Éº */}
                    <div>
                      <h4 className="font-medium text-gray-800 mb-3">üìñ Áâ©Ë™û</h4>
                      <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <div className="text-sm text-blue-800">
                          {activeQuest.narrative.progressUpdates[Math.floor(activeQuest.progress / 25) * 25] || 
                           activeQuest.narrative.introduction}
                        </div>
                      </div>
                    </div>

                    {/* „Ç≠„É£„É©„ÇØ„Çø„Éº */}
                    {activeQuest.narrative.characterDialogue.map((dialogue, index) => (
                      <div key={index} className="bg-gray-50 border border-gray-200 rounded-lg p-3">
                        <div className="flex items-center space-x-2 mb-2">
                          <span className="text-lg">
                            {dialogue.character === 'wise_owl' ? 'ü¶â' : 'üê±'}
                          </span>
                          <span className="text-sm font-medium text-gray-800">
                            {dialogue.character === 'wise_owl' ? '„Éï„ÇØ„É≠„Ç¶ÂÖàÁîü' : '„Ç´„É´„ÇØ„É´'}
                          </span>
                        </div>
                        <div className="text-sm text-gray-700">"{dialogue.dialogue}"</div>
                      </div>
                    ))}
                  </div>
                </div>
              </KidsCard>

              {/* „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÉÅ„É£„É¨„É≥„Ç∏ */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {gamificationProfile.challenges.filter(c => c.status === 'active').map((challenge) => (
                  <KidsCard key={challenge.challengeId} title="üèÉ‚Äç‚ôÇÔ∏è „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„ÉÅ„É£„É¨„É≥„Ç∏" icon="‚ö°" color="orange">
                    <div className="space-y-4">
                      <div>
                        <h3 className="font-semibold text-gray-800 mb-2">{challenge.title}</h3>
                        <p className="text-sm text-gray-600 mb-3">{challenge.description}</p>
                        
                        <div className="mb-3">
                          <div className="flex justify-between text-sm mb-1">
                            <span>ÈÄ≤Êçó</span>
                            <span>{challenge.progress.current}/{challenge.progress.target}</span>
                          </div>
                          <AnimatedProgress 
                            progress={(challenge.progress.current / challenge.progress.target) * 100}
                            color="orange"
                          />
                        </div>
                      </div>

                      <div>
                        <h4 className="text-sm font-medium text-gray-800 mb-2">„Éû„Ç§„É´„Çπ„Éà„Éº„É≥</h4>
                        <div className="space-y-2">
                          {challenge.progress.milestones.map((milestone, index) => (
                            <div key={index} className={`text-xs p-2 rounded ${
                              milestone.reached 
                                ? 'bg-green-100 text-green-800' 
                                : challenge.progress.current >= milestone.milestone
                                  ? 'bg-yellow-100 text-yellow-800'
                                  : 'bg-gray-100 text-gray-600'
                            }`}>
                              {milestone.reached ? '‚úÖ' : challenge.progress.current >= milestone.milestone ? 'üéØ' : '‚≠ï'} 
                              {milestone.description} ({milestone.reward})
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="text-xs text-gray-500">
                        ÊÆã„ÇäÊôÇÈñì: {Math.ceil((challenge.endDate.getTime() - Date.now()) / (24 * 60 * 60 * 1000))}Êó•
                      </div>
                    </div>
                  </KidsCard>
                ))}
              </div>
            </div>
          )}

          {/* ÂÆüÁ∏æ„Çø„Éñ */}
          {selectedTab === 'achievements' && (
            <div className="space-y-6">
              {/* ÂÆüÁ∏æÁµ±Ë®à */}
              <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <KidsCard title="üìä ÂÆüÁ∏æÁµ±Ë®à" icon="üìà" color="yellow">
                  <div className="text-center">
                    <div className="text-3xl font-bold text-yellow-600 mb-2">
                      {gamificationProfile.achievements.length}
                    </div>
                    <div className="text-sm text-gray-600">Áç≤ÂæóÂÆüÁ∏æÊï∞</div>
                  </div>
                </KidsCard>

                <KidsCard title="üèÖ „Éê„ÉÉ„Ç∏„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥" icon="üèÜ" color="blue">
                  <div className="text-center">
                    <div className="text-3xl font-bold text-blue-600 mb-2">
                      {gamificationProfile.badges.length}
                    </div>
                    <div className="text-sm text-gray-600">Áç≤Âæó„Éê„ÉÉ„Ç∏Êï∞</div>
                  </div>
                </KidsCard>

                <KidsCard title="üíé „É¨„Ç¢„É™„ÉÜ„Ç£ÂàÜÂ∏É" icon="‚ú®" color="purple">
                  <div className="text-center">
                    <div className="text-sm space-y-1">
                      {['legendary', 'epic', 'rare', 'uncommon', 'common'].map(rarity => {
                        const count = gamificationProfile.achievements.filter(a => a.rarity === rarity).length;
                        return (
                          <div key={rarity} className="flex justify-between">
                            <span>
                              {rarity === 'legendary' ? '‚≠ê' :
                               rarity === 'epic' ? 'üíú' :
                               rarity === 'rare' ? 'üíé' :
                               rarity === 'uncommon' ? 'ü•à' : 'ü•â'}
                            </span>
                            <span>{count}</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </KidsCard>

                <KidsCard title="üéØ Á∑è„Éù„Ç§„É≥„Éà" icon="üíØ" color="green">
                  <div className="text-center">
                    <div className="text-3xl font-bold text-green-600 mb-2">
                      {gamificationProfile.achievements.reduce((sum, a) => sum + a.points, 0)}
                    </div>
                    <div className="text-sm text-gray-600">ÂÆüÁ∏æ„Éù„Ç§„É≥„Éà</div>
                  </div>
                </KidsCard>
              </div>

              {/* ÂÆüÁ∏æ‰∏ÄË¶ß */}
              <KidsCard title="üèÜ Áç≤ÂæóÂÆüÁ∏æ‰∏ÄË¶ß" icon="üéñÔ∏è" color="yellow">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {gamificationProfile.achievements.map((achievement) => (
                    <HoverScaleCard
                      key={achievement.achievementId}
                      className="bg-white border border-gray-200 rounded-lg p-4"
                    >
                      <div className="text-center">
                        <div className="text-4xl mb-3">{achievement.icon}</div>
                        <h3 className="font-semibold text-gray-800 mb-2">
                          {achievement.title}
                        </h3>
                        <p className="text-sm text-gray-600 mb-3">
                          {achievement.description}
                        </p>
                        <div className="flex justify-between items-center">
                          <span className={`text-xs px-2 py-1 rounded ${
                            achievement.rarity === 'legendary' ? 'bg-yellow-100 text-yellow-800' :
                            achievement.rarity === 'epic' ? 'bg-purple-100 text-purple-800' :
                            achievement.rarity === 'rare' ? 'bg-blue-100 text-blue-800' :
                            achievement.rarity === 'uncommon' ? 'bg-gray-100 text-gray-800' :
                            'bg-green-100 text-green-800'
                          }`}>
                            {achievement.rarity === 'legendary' ? '‚≠ê „É¨„Ç∏„Çß„É≥„ÉÄ„É™„Éº' :
                             achievement.rarity === 'epic' ? 'üíú „Ç®„Éî„ÉÉ„ÇØ' :
                             achievement.rarity === 'rare' ? 'üíé „É¨„Ç¢' :
                             achievement.rarity === 'uncommon' ? 'ü•à „Ç¢„É≥„Ç≥„É¢„É≥' : 'ü•â „Ç≥„É¢„É≥'}
                          </span>
                          <span className="text-sm font-bold text-yellow-600">
                            {achievement.points}pt
                          </span>
                        </div>
                        <div className="text-xs text-gray-500 mt-2">
                          {achievement.unlockedAt.toLocaleDateString()}
                        </div>
                      </div>
                    </HoverScaleCard>
                  ))}
                </div>
              </KidsCard>

              {/* „Éê„ÉÉ„Ç∏‰∏ÄË¶ß */}
              <KidsCard title="üèÖ Áç≤Âæó„Éê„ÉÉ„Ç∏" icon="üéñÔ∏è" color="blue">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  {gamificationProfile.badges.map((badge) => (
                    <HoverScaleCard
                      key={badge.badgeId}
                      className="bg-white border border-gray-200 rounded-lg p-4"
                    >
                      <div className="text-center">
                        <div className="w-16 h-16 mx-auto mb-3 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center">
                          <span className="text-white font-bold text-lg">
                            {badge.design.symbols[0] || 'üèÖ'}
                          </span>
                        </div>
                        <h3 className="font-semibold text-gray-800 mb-1">
                          {badge.name}
                        </h3>
                        <p className="text-xs text-gray-600 mb-2">
                          {badge.description}
                        </p>
                        <div className="text-xs">
                          <span className="text-gray-500">„É¨„Éô„É´ </span>
                          <span className="font-bold text-blue-600">
                            {badge.level}/{badge.maxLevel}
                          </span>
                        </div>
                      </div>
                    </HoverScaleCard>
                  ))}
                </div>
              </KidsCard>
            </div>
          )}
        </div>
      </div>

      {/* „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */}
      <FloatingActionButton
        icon="üéÆ"
        onClick={() => {
          // „ÇØ„Ç§„ÉÉ„ÇØ„Ç≤„Éº„É†ÈñãÂßã
          console.log('„ÇØ„Ç§„ÉÉ„ÇØ„Ç≤„Éº„É†ÈñãÂßã');
        }}
        tooltip="„ÇØ„Ç§„ÉÉ„ÇØ„Ç≤„Éº„É†"
        color="purple"
        position="bottom-right"
      />
    </div>
  );
};

export default AdvancedGamificationHub;